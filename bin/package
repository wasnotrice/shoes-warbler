#!/usr/bin/env ruby

require 'yaml'
require 'warbler'

module Shoes
  module Swt
    module Package
      class Jar
        def initialize(config_file)
          app = {}
          if File.exist?(config_file)
            puts "Using config file: #{config_file}"
            app = YAML.load(File.read config_file)
          end

          @config = Warbler::Config.new do |c|
            c.jar_name = app['name'] if app['name']
          end

          Warbler::Task.new(nil, @config)
        end

        def create(config=@config)
          Dir.chdir(File.expand_path '../..', __FILE__) do
            Rake.application['jar:clean'].invoke
            Rake.application['jar'].invoke
          end
        end
      end
    end
  end
end

jar = Shoes::Swt::Package::Jar.new(File.expand_path '../../app.yaml', __FILE__)
jar.create

